let role_user,ijinakses_role={Admin:["Admin","Member","User"],Member:["Member","User"],User:["User"]};async function cekAksesPremium(e){let a=auth.currentUser?auth.currentUser.uid:null;if(!a)return console.warn(`belum login, akses ditolak. ${a}`),{akses:!1,alasan:"Belum Login"};if(!role_user)try{let t=await db.collection("users").doc(a).get();if(!t.exists)return console.warn("Role tidak ada dalam basis data, akses ditolak."),{akses:!1,alasan:"Role tidak ditemukan dalam database"};role_user=t.data().role,console.log("Role yang ditemukan: ",role_user)}catch(l){return console.error("Error saat mengambil role: ",l),{akses:!1,alasan:"Error saat mengambil role"}}return ijinakses_role[role_user]?ijinakses_role[role_user].includes(e)?(console.log(`Akses diberikan untuk role '${role_user}' ke role yang diperlukan '${e}'.`),{akses:!0,role:role_user}):(console.warn(`Akses ditolak untuk role:  '${role_user}' untuk role yang dibutuhkan adalah '${e}'.`),{akses:!1,alasan:"Role tidak memiliki izin yang dibutuhkan untuk Episode premium"}):(console.warn(`Role '${role_user}' tidak didefinisikan dalam izin akses Episode, akses ditolak.`),{akses:!1,alasan:"Role tidak ditentukan dalam izin akses Episode ini"})}async function get_akses(e){let a=e.role||"",t=await cekAksesPremium(a);return{syaratrole:a,akses:t}}async function runMainScriptplayer(){if("object"!=typeof streamingFiles||0===streamingFiles.length||"string"!=typeof streamingId)return;let e=document.getElementById("list-episode"),a=document.getElementById("lightBulb");function t(e,a){return`<iframe loading="lazy" class="focus:outline-none" src="${e}" title="${a}" allow="accelerometer; autoplay; gyroscope; picture-in-picture" allowfullscreen="" loading="eager" frameborder="0"></iframe>`}async function l(){if(e){let a="";for(let[l,$]of streamingFiles.entries()){var s,i,r,n,d,o,_,u,c;let{syaratrole:p,akses:m}=await get_akses($);p?m.akses?a+=(s=$.title,i=$.episode,`<a data-index="${r=l}" data-episode-list-index="${i}" class="before:bg-accent ssl visited:text-neutral-400 dark:visited:text-neutral-600 relative flex gap-5 bg-white px-4 py-2 text-sm font-normal before:absolute before:inset-y-0 before:left-0 before:h-full odd:bg-opacity-10 even:bg-opacity-0 lg:py-3 lg:font-medium" href="#${i}" title="${s}"> ${i} <span class="line-clamp-1 max-w-[75%]">${s}</span><svg class="hidden ms-auto" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16a8 8 0 0 0 0 16ZM9.555 7.168A1 1 0 0 0 8 8v4a1 1 0 0 0 1.555.832l3-2a1 1 0 0 0 0-1.664l-3-2Z" clip-rule="evenodd"/></svg></a>`):(a+=(n=$.title,d=$.episode,`<a data-index="${o=l}" onclick="alert('Akses ditolak untuk ${$.title} - episode ${d}. dikarenakan: ${m.alasan}')" data-episode-list-index="#" class="before:bg-accent ssl visited:text-neutral-400 dark:visited:text-neutral-600 relative flex gap-5 bg-white px-4 py-2 text-sm font-normal before:absolute before:inset-y-0 before:left-0 before:h-full odd:bg-opacity-10 even:bg-opacity-0 lg:py-3 lg:font-medium" href="#${d}" title="${n}"> ${d} <span class="line-clamp-1 max-w-[75%]">${n}</span><svg class="ms-auto" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path  fill="${"Member"==$.role?"gold":"Admin"==$.role?"#a0ff00":"white"}" d="M11.2 1.401a1 1 0 0 1 1.516-.1l.085.1L15.5 5h4.645a1.5 1.5 0 0 1 1.367 2.119l-.06.116l-8.363 14.868a1.25 1.25 0 0 1-2.105.115l-.073-.115L2.548 7.235a1.5 1.5 0 0 1 1.177-2.23L3.855 5H8.5zM8.433 7H4.71L12 19.96L19.29 7h-3.724l-2.623 4.371a1.1 1.1 0 0 1-1.886 0zM12 3.667l-1.796 2.395L12 9.056l1.797-2.994z"/></g></svg></a>`),console.warn(`Akses ditolak untuk episode ${$.title}. ${m.alasan}`)):a+=(_=$.title,u=$.episode,`<a data-index="${c=l}" data-episode-list-index="${u}" class="before:bg-accent ssl visited:text-neutral-400 dark:visited:text-neutral-600 relative flex gap-5 bg-white px-4 py-2 text-sm font-normal before:absolute before:inset-y-0 before:left-0 before:h-full odd:bg-opacity-10 even:bg-opacity-0 lg:py-3 lg:font-medium" href="#${u}" title="${_}"> ${u} <span class="line-clamp-1 max-w-[75%]">${_}</span><svg class="hidden ms-auto" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16a8 8 0 0 0 0 16ZM9.555 7.168A1 1 0 0 0 8 8v4a1 1 0 0 0 1.555.832l3-2a1 1 0 0 0 0-1.664l-3-2Z" clip-rule="evenodd"/></svg></a>`)}e.innerHTML=a;let f=e.querySelectorAll("a"),g=document.getElementById("pembed"),k=document.getElementById("sub-server"),h=document.getElementById("dub-server"),b=document.getElementById("epname"),y=document.querySelectorAll(".npep"),v=document.querySelector('input[name="episode_number"]');f.forEach((e,a)=>{e.addEventListener("click",e=>{let l=e.currentTarget,$=streamingFiles.find(e=>e.episode==l.dataset.episodeListIndex);g.innerHTML=t($.files[0][1],$.title),localStorage.setItem(`${streamingId} last-watched`,a),(h||k).parentElement.querySelectorAll("span").forEach(e=>{"dub"!==e.dataset.type&&"sub"!==e.dataset.type&&e.remove()}),y.forEach(e=>{"prev"===e.dataset.type?a-1!=-1?(e.href=`#${a-1}`,e.dataset.index=a-1,e.disabled=!1):(e.removeAttribute("href"),e.disabled=!0):"next"===e.dataset.type&&(a+1!==f.length?(e.href=`#${a+1}`,e.dataset.index=a+1,e.disabled=!1):(e.removeAttribute("href"),e.disabled=!0))}),$.files.forEach(e=>{var a,l;let $,s=(a=e[0],l=e[1],($=document.createElement("span")).className="bg-accent w-fit cursor-pointer rounded-sm px-2 py-1 shadow-md drop-shadow",$.dataset.url=l,$.innerHTML=a,$);s.addEventListener("click",()=>{g.innerHTML=t(e[1],e[0])}),"dub"===e[2]?h.appendChild(s):k.appendChild(s)}),b.innerHTML=`Episode ${$.episode}`,f.forEach(e=>e.classList.remove("active")),l.classList.add("active")})}),y.forEach(e=>{e.addEventListener("click",e=>{e.currentTarget.href&&f[e.currentTarget.dataset.index].click()})}),v.addEventListener("keyup",e=>{f.forEach(a=>{a.dataset.episodeListIndex.includes(e.currentTarget.value)?a.style.display="":a.style.display="none"})});let w=localStorage.getItem(`${streamingId} last-watched`);w?f[w].click():f[0].click()}}l(),a&&[a,document.getElementById("shadow")].forEach(e=>{e.addEventListener("click",()=>{document.getElementById("shadow").classList.toggle("active")})})}auth.onAuthStateChanged(e=>{runMainScriptplayer()});